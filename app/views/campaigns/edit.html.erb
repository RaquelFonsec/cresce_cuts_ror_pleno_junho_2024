<div class="container mt-5">
  <h1 class="mb-4">Edit Campaign</h1>

  <%= form_for @campaign, html: { class: "form", multipart: true } do |f| %>
    <% if @campaign.errors.any? %>
      <div id="error_explanation" class="alert alert-danger">
        <h2><%= pluralize(@campaign.errors.count, "error") %> prohibited this campaign from being saved:</h2>
        <ul>
          <% @campaign.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="form-group">
      <%= f.label :product_id, "Product", class: "form-label" %>
      <%= f.collection_select :product_id, @products, :id, :name, { prompt: "Select a product" }, class: "form-control" %>
    </div>

    <div class="form-group">
      <%= f.label :description, class: "form-label" %>
      <%= f.text_area :description, class: "form-control", placeholder: "Enter description" %>
    </div>

    <div class="form-row">
      <div class="form-group col-md-6">
        <%= f.label :original_price, class: "form-label" %>
        <%= f.text_field :original_price, class: "form-control", placeholder: "Enter original price" %>
      </div>

      <div class="form-group col-md-6">
        <%= f.label :discounted_price, class: "form-label" %>
        <%= f.text_field :discounted_price, class: "form-control", placeholder: "Enter discounted price" %>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group col-md-6">
        <%= f.label :start_date, class: "form-label" %>
        <%= f.date_field :start_date, class: "form-control" %>
      </div>

      <div class="form-group col-md-6">
        <%= f.label :end_date, class: "form-label" %>
        <%= f.date_field :end_date, class: "form-control" %>
      </div>
    </div>

    <!-- Incluindo os campos de desconto dentro de fields_for -->
    <%= f.fields_for :discount, @campaign.discount || @campaign.build_discount do |discount_form| %>
      <div class="form-group">
        <%= discount_form.label :discount_type, "Discount Type", class: "form-label" %>
        <%= discount_form.select :discount_type, [['Percentage', 'percentual'], ['Fixed Amount', 'valor_fixo']], { prompt: "Select discount type" }, class: "form-control" %>
      </div>
    <% end %>

    <div class="form-group">
      <%= f.label :status, "Status", class: "form-label" %>
      <%= f.select :status, Campaign.statuses.keys.map { |status| [status.titleize, status] }, { prompt: "Select status" }, class: "form-control" %>
    </div>

    <div class="form-group">
      <%= f.label :image, "Upload Image", class: "form-label" %>
      <%= f.file_field :image, class: "form-control-file" %>
    </div>

    <div class="form-group">
      <%= f.submit "Save Changes", class: "btn btn-primary mr-2" %>
      <%= link_to 'Back to Campaigns', campaigns_path, class: "btn btn-secondary" %>
    </div>
  <% end %>
</div>
